# 文本输入功能快速上手

## 三种使用方式

### 方式1：命令行输入（快速测试）

```bash
cd scripts
python generate_from_text_input.py \
    ../config/text/diffusion_bedrooms_instancond_lat32_v_bert.yaml \
    ../outputs/test \
    ../3d_front_processed/threed_future_model_bedroom.pkl \
    --weight_file ../pretrained_diffusion/bedrooms_bert/model_32000 \
    --enable_text_input \
    --text "一个有大床、两个床头柜和一个衣柜的卧室" \
    --n_sequences 3 \
    --render_top2down \
    --save_mesh \
    --clip_denoised \
    --retrive_objfeats \
    --path_to_3d_future_models_dir ../dataset/3D-FUTURE-model
```

### 方式2：单文件输入

1. 创建文本文件：
```bash
echo "a cozy bedroom with a bed, nightstands, and a wardrobe" > demo/my_room.txt
```

2. 运行生成：
```bash
cd scripts
python generate_from_text_input.py \
    ../config/text/diffusion_bedrooms_instancond_lat32_v_bert.yaml \
    ../outputs/single_file \
    ../3d_front_processed/threed_future_model_bedroom.pkl \
    --weight_file ../pretrained_diffusion/bedrooms_bert/model_32000 \
    --enable_text_input \
    --text_file ../demo/my_room.txt \
    --n_sequences 5 \
    --render_top2down \
    --save_mesh \
    --clip_denoised \
    --retrive_objfeats \
    --path_to_3d_future_models_dir ../dataset/3D-FUTURE-model
```

### 方式3：批量目录输入（推荐）

1. 准备文本文件（已包含示例文件）：
```bash
ls demo/text_inputs/
# bedroom_01.txt
# bedroom_02.txt
# livingroom_01.txt
# diningroom_01.txt
# ...
```

2. 运行批量生成：
```bash
cd run
bash generate_text_input.sh
```

## 输出结构

```
outputs/
└── batch_generation/
    ├── generation_records.jsonl       # 所有记录
    ├── text_0000_bedroom_01/          # 第1个文本的结果
    │   ├── input_text.txt             # 输入文本
    │   ├── generation_summary.json    # 摘要信息
    │   ├── seq_000_*.png              # 渲染图
    │   └── seq_000_*.ply              # 3D模型
    ├── text_0001_bedroom_02/          # 第2个文本的结果
    └── ...
```

## 重要参数

- `--enable_text_input`: **必需**，启用文本输入功能
- `--text`: 命令行文本（三选一）
- `--text_file`: 单文件路径（三选一）
- `--text_dir`: 目录路径（三选一）
- `--n_sequences`: 每个文本生成几个场景（默认10）
- `--save_records`: 保存记录（默认开启）

## 切换房间类型

编辑 `run/generate_text_input.sh`，修改：

```bash
ROOM_TYPE="bedrooms"      # 卧室
# ROOM_TYPE="diningrooms"  # 餐厅
# ROOM_TYPE="livingrooms"  # 客厅
```

## 示例文本描述

### 卧室 (Bedroom)
- "a cozy bedroom with a queen-size bed, two nightstands, and a wardrobe"
- "a minimalist bedroom with a double bed and a single nightstand"
- "一个有大床、床头柜和书桌的现代卧室"

### 客厅 (Living Room)
- "an elegant living room with a sofa, coffee table, and TV stand"
- "a comfortable living room with an L-shaped sofa and bookshelf"
- "一个有沙发、茶几和电视柜的宽敞客厅"

### 餐厅 (Dining Room)
- "a spacious dining room with a large table and six chairs"
- "a modern dining room with a rectangular table and storage cabinet"
- "一个有大餐桌和餐边柜的餐厅"

## 查看结果

1. **渲染图**：直接查看 `.png` 文件
2. **3D模型**：使用MeshLab、Blender等工具打开 `.ply` 文件
3. **记录分析**：查看 `generation_records.jsonl`

## 完整文档

详细说明请参阅：[TEXT_INPUT_GUIDE.md](TEXT_INPUT_GUIDE.md)
